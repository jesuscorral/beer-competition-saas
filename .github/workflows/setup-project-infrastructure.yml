name: Setup Project Infrastructure
on:
  workflow_dispatch:
   

jobs:
  setup-labels:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    
    steps:
      - name: Setup Agent Labels
        uses: actions/github-script@v7
        with:
          script: |
            console.log('üè∑Ô∏è Creating agent labels...');
            
            const agentLabels = [
              {
                name: 'agent:backend',
                color: '0052CC',
                description: 'üèóÔ∏è Backend API & Business Logic - .NET, CQRS, Events'
              },
              {
                name: 'agent:frontend',
                color: '61DAFB',
                description: 'üé® Frontend UI & PWA - React, TypeScript, Offline-first'
              },
              {
                name: 'agent:data-science',
                color: 'F37626',
                description: 'üî¨ ML & Analytics - Python, FastAPI, Models'
              },
              {
                name: 'agent:devops',
                color: '326CE5',
                description: 'üöÄ Infrastructure & DevOps - Docker, CI/CD, Monitoring'
              },
              {
                name: 'agent:qa',
                color: '00C853',
                description: '‚úÖ Testing & QA - Unit, Integration, E2E Tests'
              },
              {
                name: 'agent:architecture',
                color: '9C27B0',
                description: 'üìã Architecture & Design - ADRs, Patterns, Review'
              }
            ];

            for (const label of agentLabels) {
              try {
                await github.rest.issues.createLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  name: label.name,
                  color: label.color,
                  description: label.description
                });
                console.log(`‚úÖ Created: ${label.name}`);
              } catch (error) {
                if (error.status === 422) {
                  // Label exists, update it
                  await github.rest.issues.updateLabel({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    name: label.name,
                    color: label.color,
                    description: label.description
                  });
                  console.log(`üîÑ Updated: ${label.name}`);
                } else {
                  console.error(`‚ùå Error creating ${label.name}:`, error.message);
                }
              }
            }

      - name: Setup Coordination Labels
        uses: actions/github-script@v7
        with:
          script: |
            console.log('ü§ù Creating coordination labels...');
            
            const coordinationLabels = [
              {
                name: 'multi-agent-task',
                color: 'FBCA04',
                description: 'üîÑ Requires coordination between multiple agents'
              },
              {
                name: 'agent-handoff',
                color: 'D4C5F9',
                description: 'ü§ù Task handoff between agents'
              },
              {
                name: 'agent-question',
                color: 'FEF2C0',
                description: '‚ùì Question for another agent'
              },
              {
                name: 'needs-response',
                color: 'D93F0B',
                description: 'üí¨ Waiting for response from assigned agent'
              },
              {
                name: 'blocked',
                color: 'B60205',
                description: 'üö´ Blocked by dependencies or external factors'
              }
            ];

            for (const label of coordinationLabels) {
              try {
                await github.rest.issues.createLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  name: label.name,
                  color: label.color,
                  description: label.description
                });
                console.log(`‚úÖ Created: ${label.name}`);
              } catch (error) {
                if (error.status === 422) {
                  await github.rest.issues.updateLabel({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    name: label.name,
                    color: label.color,
                    description: label.description
                  });
                  console.log(`üîÑ Updated: ${label.name}`);
                } else {
                  console.error(`‚ùå Error creating ${label.name}:`, error.message);
                }
              }
            }

      - name: Setup Priority Labels
        uses: actions/github-script@v7
        with:
          script: |
            console.log('üìä Creating priority labels...');
            
            const priorityLabels = [
              {
                name: 'priority:critical',
                color: 'B60205',
                description: 'üî¥ Critical - Blocker for release'
              },
              {
                name: 'priority:high',
                color: 'D93F0B',
                description: 'üü† High - Important for MVP'
              },
              {
                name: 'priority:medium',
                color: 'FBCA04',
                description: 'üü° Medium - Should have'
              },
              {
                name: 'priority:low',
                color: '0E8A16',
                description: 'üü¢ Low - Nice to have'
              }
            ];

            for (const label of priorityLabels) {
              try {
                await github.rest.issues.createLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  name: label.name,
                  color: label.color,
                  description: label.description
                });
                console.log(`‚úÖ Created: ${label.name}`);
              } catch (error) {
                if (error.status === 422) {
                  await github.rest.issues.updateLabel({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    name: label.name,
                    color: label.color,
                    description: label.description
                  });
                  console.log(`üîÑ Updated: ${label.name}`);
                } else {
                  console.error(`‚ùå Error creating ${label.name}:`, error.message);
                }
              }
            }

      - name: Setup Complexity Labels
        uses: actions/github-script@v7
        with:
          script: |
            console.log('‚öôÔ∏è Creating complexity labels...');
            
            const complexityLabels = [
              {
                name: 'complexity:trivial',
                color: 'C5DEF5',
                description: 'üêõ Trivial (< 1 hour)'
              },
              {
                name: 'complexity:simple',
                color: '5EBEFF',
                description: 'üìù Simple (1-4 hours)'
              },
              {
                name: 'complexity:moderate',
                color: '1D76DB',
                description: '‚öôÔ∏è Moderate (1-2 days)'
              },
              {
                name: 'complexity:complex',
                color: '0E4C92',
                description: 'üîß Complex (3-5 days)'
              },
              {
                name: 'complexity:epic',
                color: '0A2647',
                description: 'üèóÔ∏è Epic (> 1 week, should be split)'
              }
            ];

            for (const label of complexityLabels) {
              try {
                await github.rest.issues.createLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  name: label.name,
                  color: label.color,
                  description: label.description
                });
                console.log(`‚úÖ Created: ${label.name}`);
              } catch (error) {
                if (error.status === 422) {
                  await github.rest.issues.updateLabel({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    name: label.name,
                    color: label.color,
                    description: label.description
                  });
                  console.log(`üîÑ Updated: ${label.name}`);
                } else {
                  console.error(`‚ùå Error creating ${label.name}:`, error.message);
                }
              }
            }

      - name: Setup Type Labels
        uses: actions/github-script@v7
        with:
          script: |
            console.log('üì¶ Creating type labels...');
            
            const typeLabels = [
              {
                name: 'type:feature',
                color: 'A2EEEF',
                description: '‚ú® New feature or enhancement'
              },
              {
                name: 'type:bug',
                color: 'D73A4A',
                description: 'üêõ Bug fix'
              },
              {
                name: 'type:infrastructure',
                color: '6F42C1',
                description: 'üèóÔ∏è Infrastructure setup or configuration'
              },
              {
                name: 'type:documentation',
                color: '0075CA',
                description: 'üìö Documentation updates'
              },
              {
                name: 'type:refactor',
                color: 'EDEDED',
                description: '‚ôªÔ∏è Code refactoring'
              },
              {
                name: 'type:test',
                color: 'BFDADC',
                description: 'üß™ Test-related changes'
              },
              {
                name: 'type:security',
                color: 'FF6B6B',
                description: 'üîí Security-related issue or improvement'
              }
            ];

            for (const label of typeLabels) {
              try {
                await github.rest.issues.createLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  name: label.name,
                  color: label.color,
                  description: label.description
                });
                console.log(`‚úÖ Created: ${label.name}`);
              } catch (error) {
                if (error.status === 422) {
                  await github.rest.issues.updateLabel({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    name: label.name,
                    color: label.color,
                    description: label.description
                  });
                  console.log(`üîÑ Updated: ${label.name}`);
                } else {
                  console.error(`‚ùå Error creating ${label.name}:`, error.message);
                }
              }
            }

      - name: Setup Status Labels
        uses: actions/github-script@v7
        with:
          script: |
            console.log('üìç Creating status labels...');
            
            const statusLabels = [
              {
                name: 'status:needs-triage',
                color: 'EEEEEE',
                description: 'üîç Needs review and assignment'
              },
              {
                name: 'status:in-progress',
                color: '0052CC',
                description: 'üèÉ Currently being worked on'
              },
              {
                name: 'status:in-review',
                color: 'FFA500',
                description: 'üëÄ In code review'
              },
              {
                name: 'status:ready-to-merge',
                color: '00FF00',
                description: '‚úÖ Approved and ready to merge'
              },
              {
                name: 'status:on-hold',
                color: 'CCCCCC',
                description: '‚è∏Ô∏è On hold, not currently active'
              }
            ];

            for (const label of statusLabels) {
              try {
                await github.rest.issues.createLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  name: label.name,
                  color: label.color,
                  description: label.description
                });
                console.log(`‚úÖ Created: ${label.name}`);
              } catch (error) {
                if (error.status === 422) {
                  await github.rest.issues.updateLabel({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    name: label.name,
                    color: label.color,
                    description: label.description
                  });
                  console.log(`üîÑ Updated: ${label.name}`);
                } else {
                  console.error(`‚ùå Error creating ${label.name}:`, error.message);
                }
              }
            }

      - name: Setup Epic Labels
        uses: actions/github-script@v7
        with:
          script: |
            console.log('üéØ Creating epic labels...');
            
            const epicLabels = [
              {
                name: 'epic:competition-management',
                color: '8B4513',
                description: 'üèÜ E1: Competition Management'
              },
              {
                name: 'epic:entry-management',
                color: 'CD853F',
                description: 'üìù E2: Entry Management'
              },
              {
                name: 'epic:flight-organization',
                color: 'DEB887',
                description: '‚úàÔ∏è E3: Flight Organization'
              },
              {
                name: 'epic:check-in-process',
                color: 'F4A460',
                description: 'üì¶ E4: Check-in & Bottle Processing'
              },
              {
                name: 'epic:judging-workflow',
                color: 'DAA520',
                description: '‚öñÔ∏è E5: Judging Workflow'
              },
              {
                name: 'epic:authentication',
                color: 'B8860B',
                description: 'üîê E6: Authentication & Authorization'
              },
              {
                name: 'epic:analytics',
                color: 'FF8C00',
                description: 'üìä Analytics & ML Features'
              }
            ];

            for (const label of epicLabels) {
              try {
                await github.rest.issues.createLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  name: label.name,
                  color: label.color,
                  description: label.description
                });
                console.log(`‚úÖ Created: ${label.name}`);
              } catch (error) {
                if (error.status === 422) {
                  await github.rest.issues.updateLabel({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    name: label.name,
                    color: label.color,
                    description: label.description
                  });
                  console.log(`üîÑ Updated: ${label.name}`);
                } else {
                  console.error(`‚ùå Error creating ${label.name}:`, error.message);
                }
              }
            }
